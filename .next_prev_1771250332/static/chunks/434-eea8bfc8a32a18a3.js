"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[434],{814:(e,r,t)=>{t.r(r),t.d(r,{AppShell:()=>p});var s=t(5155),a=t(2619),n=t.n(a),l=t(2115),d=t(9540),o=t(5229),i=t(6445),c=t(3998),u=t(7539),m=t(7777),x=t(5752);function p(e){let{nav:r,currentPath:t,children:a,status:p="ready"}=e,[b,f]=(0,l.useState)(!1),[h,g]=(0,l.useState)(!1),j=(0,l.useMemo)(()=>x.Vs.map(e=>({...e,items:r.filter(r=>r.group===e.key)})),[r]),v=r.find(e=>(0,x.Pt)(t,e.href));return(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("aside",{className:"sticky top-0 hidden h-screen w-[292px] shrink-0 border-r border-sidebar-border/80 bg-sidebar/90 p-4 backdrop-blur-md supports-[backdrop-filter]:bg-sidebar/84 md:block",children:[(0,s.jsxs)(n(),{href:"/dashboard",className:"mb-6 block rounded-2xl border border-border/70 bg-card p-3",children:[(0,s.jsx)("p",{className:"text-[11px] uppercase tracking-[0.18em] text-muted-foreground",children:"AI School"}),(0,s.jsx)("p",{className:"mt-1 font-display text-lg font-semibold text-foreground",children:"Institute Console"}),(0,s.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"Admissions to outcomes, in one academic workspace."})]}),(0,s.jsx)("div",{className:"space-y-5",children:j.map(e=>e.items.length>0?(0,s.jsxs)("section",{"aria-label":e.label,children:[(0,s.jsx)("h2",{className:"px-2 text-[11px] font-semibold uppercase tracking-[0.12em] text-muted-foreground",children:e.label}),(0,s.jsx)("nav",{className:"mt-2 space-y-1.5",children:e.items.map(e=>{let r=(0,x.Pt)(t,e.href);return(0,s.jsxs)(n(),{href:e.href,className:(0,i.cn)("block rounded-xl border px-3 py-2.5 transition-colors",r?"border-primary/35 bg-primary/10 text-foreground":"border-transparent text-muted-foreground hover:border-border hover:bg-sidebar-muted/80 hover:text-foreground"),children:[(0,s.jsx)("p",{className:"text-sm font-semibold",children:e.label}),e.description?(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description}):null]},e.href)})})]},e.key):null)})]}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("header",{className:"sticky top-0 z-30 border-b border-border/70 glass",children:(0,s.jsxs)("div",{className:"flex h-16 items-center justify-between gap-3 px-4 md:px-6",children:[(0,s.jsxs)("div",{className:"flex min-w-0 items-center gap-3",children:[(0,s.jsx)("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-border text-muted-foreground md:hidden",onClick:()=>f(!0),"aria-label":"Open navigation",children:(0,s.jsx)(d.A,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-[11px] uppercase tracking-[0.12em] text-muted-foreground",children:"Institute Workspace"}),(0,s.jsx)("p",{className:"truncate font-display text-lg font-semibold text-foreground",children:(null==v?void 0:v.label)||"Learning Surface"})]})]}),(0,s.jsx)(c.$,{variant:"secondary",size:"sm",onClick:()=>g(!0),children:"View activity"})]})}),(0,s.jsxs)("main",{className:"px-4 py-4 md:px-6 md:py-6",children:[(0,s.jsx)(m.StatusStrip,{status:p,onViewActivity:()=>g(!0)}),(0,s.jsx)("div",{className:"mt-4 animate-fade-in",children:a})]})]})]}),b?(0,s.jsxs)("div",{className:"fixed inset-0 z-40 md:hidden",children:[(0,s.jsx)("button",{type:"button",className:"absolute inset-0 bg-foreground/32 backdrop-blur-[2px]",onClick:()=>f(!1),"aria-label":"Close navigation"}),(0,s.jsxs)("div",{className:"absolute left-0 top-0 h-full w-[88%] max-w-sm border-r border-sidebar-border/80 bg-background/90 p-4 shadow-2xl backdrop-blur-2xl supports-[backdrop-filter]:bg-background/78",children:[(0,s.jsxs)("div",{className:"mb-5 flex items-center justify-between",children:[(0,s.jsx)("p",{className:"font-display text-lg font-semibold text-foreground",children:"Institute Console"}),(0,s.jsx)("button",{type:"button",onClick:()=>f(!1),className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border bg-card/80","aria-label":"Close",children:(0,s.jsx)(o.A,{className:"h-4 w-4"})})]}),(0,s.jsx)("div",{className:"space-y-5 overflow-y-auto pb-8",children:j.map(e=>e.items.length>0?(0,s.jsxs)("section",{"aria-label":e.label,children:[(0,s.jsx)("h2",{className:"px-1 text-[11px] uppercase tracking-[0.12em] text-muted-foreground",children:e.label}),(0,s.jsx)("nav",{className:"mt-2 space-y-1.5",children:e.items.map(e=>{let r=(0,x.Pt)(t,e.href);return(0,s.jsxs)(n(),{href:e.href,onClick:()=>f(!1),className:(0,i.cn)("block rounded-xl border px-3 py-2.5",r?"border-primary/35 bg-primary/10 text-foreground":"border-transparent text-muted-foreground hover:border-border hover:bg-sidebar-muted/80"),children:[(0,s.jsx)("p",{className:"text-sm font-semibold",children:e.label}),e.description?(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description}):null]},e.href)})})]},e.key):null)})]})]}):null,(0,s.jsx)(u.ActivityDrawer,{open:h,onOpenChange:g})]})}},1647:(e,r,t)=>{t.d(r,{E:()=>d});var s=t(5155);t(2115);var a=t(3101),n=t(6445);let l=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-semibold tracking-wide transition-colors",{variants:{variant:{muted:"border-border bg-muted text-muted-foreground",success:"border-emerald-300 bg-emerald-50 text-emerald-800 dark:border-emerald-800 dark:bg-emerald-950/40 dark:text-emerald-200",warn:"border-amber-300 bg-amber-50 text-amber-800 dark:border-amber-800 dark:bg-amber-950/40 dark:text-amber-200",danger:"border-red-300 bg-red-50 text-red-800 dark:border-red-800 dark:bg-red-950/40 dark:text-red-200",info:"border-sky-300 bg-sky-50 text-sky-800 dark:border-sky-800 dark:bg-sky-950/40 dark:text-sky-200"}},defaultVariants:{variant:"muted"}});function d(e){let{className:r,variant:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:t}),r),...a})}},3406:(e,r,t)=>{t.r(r),t.d(r,{Tabs:()=>n});var s=t(5155);t(2115);var a=t(6445);function n(e){let{items:r,value:t,onChange:n,className:l}=e;return(0,s.jsx)("div",{className:(0,a.cn)("inline-flex items-center rounded-xl border border-border bg-muted/40 p-1",l),children:r.map(e=>{let r=e.key===t;return(0,s.jsx)("button",{type:"button",onClick:()=>n(e.key),className:(0,a.cn)("rounded-lg px-3 py-1.5 text-sm transition-colors",r?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:e.label},e.key)})})}},3998:(e,r,t)=>{t.d(r,{$:()=>o,r:()=>d});var s=t(5155),a=t(2115),n=t(3101),l=t(6445);let d=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-xl text-sm font-semibold transition-all duration-200 disabled:pointer-events-none disabled:opacity-50 focus-visible:outline-none",{variants:{variant:{primary:"bg-primary text-primary-foreground shadow-sm hover:bg-primary/90 hover:shadow",secondary:"border border-border bg-background text-foreground hover:bg-muted",ghost:"text-muted-foreground hover:bg-muted hover:text-foreground",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/92",link:"h-auto p-0 text-primary underline-offset-4 hover:underline"},size:{sm:"h-8 px-3",md:"h-10 px-4",lg:"h-11 px-6",icon:"h-10 w-10"}},defaultVariants:{variant:"primary",size:"md"}}),o=a.forwardRef((e,r)=>{let{className:t,variant:a,size:n,...o}=e;return(0,s.jsx)("button",{className:(0,l.cn)(d({variant:a,size:n}),t),ref:r,...o})});o.displayName="Button"},5261:(e,r,t)=>{t.d(r,{GV:()=>s.AppShell,Ex:()=>a.E,$n:()=>n.$,Zp:()=>l.Zp,Wu:()=>l.Wu,BT:()=>l.BT,aR:()=>l.aR,ZB:()=>l.ZB,pp:()=>u,zY:()=>x,_d:()=>b,TM:()=>p}),t(7539);var s=t(814),a=t(1647),n=t(3998),l=t(6948),d=t(5155),o=t(2619),i=t.n(o),c=t(6445);function u(e){let{icon:r,title:t,description:s,ctaLabel:a,ctaHref:l,className:o}=e;return(0,d.jsxs)("div",{className:(0,c.cn)("rounded-2xl border border-dashed border-border/90 bg-muted/35 p-8 text-center",o),children:[r?(0,d.jsx)("div",{className:"mx-auto mb-3 flex h-11 w-11 items-center justify-center rounded-xl bg-background text-muted-foreground",children:r}):null,(0,d.jsx)("h3",{className:"font-display text-lg font-semibold text-foreground",children:t}),(0,d.jsx)("p",{className:"mx-auto mt-1 max-w-lg text-sm text-muted-foreground",children:s}),a&&l?(0,d.jsx)(i(),{href:l,className:(0,c.cn)((0,n.r)({variant:"primary"}),"mt-4"),children:a}):null]})}var m=t(2115);function x(e){let{title:r,subtitle:t,actions:s,className:a}=e;return(0,d.jsxs)("header",{className:(0,c.cn)("flex flex-wrap items-start justify-between gap-4",a),children:[(0,d.jsxs)("div",{className:"min-w-0",children:[(0,d.jsx)("h1",{className:"font-display text-2xl font-semibold tracking-tight text-foreground md:text-3xl",children:r}),t?(0,d.jsx)("p",{className:"mt-1.5 max-w-3xl text-sm text-muted-foreground",children:t}):null]}),s?(0,d.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:s}):null]})}m.forwardRef((e,r)=>{let{className:t,type:s,...a}=e;return(0,d.jsx)("input",{type:s,className:(0,c.cn)("flex h-10 w-full rounded-xl border border-input bg-background px-3 py-2 text-sm text-foreground transition-colors placeholder:text-muted-foreground/80 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...a})}).displayName="Input",t(6294);let p=m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("textarea",{className:(0,c.cn)("min-h-[96px] w-full rounded-xl border border-input bg-background px-3 py-2 text-sm text-foreground transition-colors placeholder:text-muted-foreground/80 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s})});function b(e){let{id:r,index:t,prompt:s,type:a,options:l,value:o,onChange:i,compact:u=!1}=e,m=function(e){let r=(e||"").toLowerCase();return"mcq"===r||"multiple_choice"===r?"mcq":"true_false"===r||"boolean"===r?"true_false":"short_answer"===r?"short_answer":"open"}(a);return(0,d.jsxs)("fieldset",{className:"surface-muted p-3","aria-label":"Question ".concat(t+1),children:[(0,d.jsx)("legend",{className:"sr-only",children:"Question ".concat(t+1)}),(0,d.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Q".concat(t+1," â€¢ ").concat(m.replace("_"," "))}),(0,d.jsx)("p",{className:(0,c.cn)("mt-1 text-sm text-foreground/95",u&&"text-xs"),children:s}),"mcq"===m&&Array.isArray(l)&&l.length>0?(0,d.jsx)("div",{className:"mt-2 grid gap-1.5",role:"radiogroup","aria-label":"Question ".concat(t+1," options"),children:l.map((e,t)=>{let s=o===t;return(0,d.jsx)("button",{type:"button",role:"radio","aria-checked":s,onClick:()=>i(t),className:(0,c.cn)("w-full rounded-lg border px-2.5 py-2 text-left text-xs transition-colors",s?"border-primary/40 bg-primary/10 text-foreground":"border-border/70 bg-background text-foreground/90 hover:bg-muted/40"),children:e},"".concat(r,"-option-").concat(t))})}):null,"true_false"===m?(0,d.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,d.jsx)(n.$,{type:"button",size:"sm",variant:!0===o?"primary":"secondary",onClick:()=>i(!0),children:"True"}),(0,d.jsx)(n.$,{type:"button",size:"sm",variant:!1===o?"destructive":"secondary",onClick:()=>i(!1),children:"False"})]}):null,"mcq"!==m&&"true_false"!==m?(0,d.jsx)(p,{value:"string"==typeof o?o:"",onChange:e=>i(e.target.value),rows:u?2:3,className:(0,c.cn)("mt-2 text-xs",u?"min-h-[64px]":"min-h-[80px]"),placeholder:"Type your answer"}):null]})}p.displayName="Textarea",t(7091);var f=t(4033);m.forwardRef((e,r)=>{let{className:t,children:s,placeholder:a,...n}=e;return(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsxs)("select",{ref:r,className:(0,c.cn)("h-10 w-full appearance-none rounded-xl border border-input bg-background px-3 pr-9 text-sm text-foreground transition-colors disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:[a?(0,d.jsx)("option",{value:"",disabled:!0,children:a}):null,s]}),(0,d.jsx)(f.A,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})]})}).displayName="Select",t(7777),m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("table",{ref:r,className:(0,c.cn)("w-full text-sm",t),...s})}).displayName="Table",m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("thead",{ref:r,className:(0,c.cn)("[&_tr]:border-b [&_tr]:border-border/70",t),...s})}).displayName="TableHeader",m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("tbody",{ref:r,className:(0,c.cn)("[&_tr:last-child]:border-0",t),...s})}).displayName="TableBody",m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("tr",{ref:r,className:(0,c.cn)("border-b border-border/60 transition-colors hover:bg-muted/40",t),...s})}).displayName="TableRow",m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("th",{ref:r,className:(0,c.cn)("h-10 px-3 text-left text-xs font-medium uppercase tracking-wide text-muted-foreground",t),...s})}).displayName="TableHead",m.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,d.jsx)("td",{ref:r,className:(0,c.cn)("px-3 py-2.5",t),...s})}).displayName="TableCell",t(3406)},5752:(e,r,t)=>{t.d(r,{FA:()=>a,Pt:()=>n,Vs:()=>s});let s=[{key:"onboarding",label:"Onboarding"},{key:"learn-hub",label:"Learn Hub"},{key:"practice",label:"Practice"},{key:"progress",label:"Progress"}],a=[{href:"/admissions",label:"Admissions",group:"onboarding",description:"Student intake and build launch"},{href:"/dashboard",label:"Dashboard",group:"learn-hub",description:"Today plan and active workload"},{href:"/programs",label:"Programs",group:"learn-hub",description:"Program management and progress"},{href:"/practice",label:"Practice",group:"practice",description:"Workbook sets and submissions"},{href:"/review",label:"Review",group:"progress",description:"Weak topics and spaced repetition"},{href:"/gradebook",label:"Gradebook",group:"progress",description:"Transcript and historical attempts"}];function n(e,r){return e===r||e.startsWith("".concat(r,"/"))}},6294:(e,r,t)=>{t.r(r),t.d(r,{LessonResources:()=>u});var s=t(5155),a=t(8486),n=t(9051),l=t(5506),d=t(406),o=t(2115),i=t(5261),c=t(7091);function u(e){let{lessonId:r,initialResources:t}=e,[u,m]=(0,o.useState)(t);return(0,s.jsxs)(i.Zp,{children:[(0,s.jsxs)(i.aR,{className:"flex flex-row items-start justify-between gap-3",children:[(0,s.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(a.A,{className:"h-4 w-4"}),"Lecture Resources"]}),(0,s.jsx)(c.RefreshResourcesButton,{lessonId:r,onRefresh:m})]}),(0,s.jsx)(i.Wu,{children:u.length>0?(0,s.jsx)("div",{className:"space-y-2",children:u.map(e=>{var r,t,a;let o=(a=e.qualityScore)>=.8?{label:"High quality",variant:"success"}:a>=.6?{label:"Good quality",variant:"info"}:a>=.4?{label:"Fair quality",variant:"warn"}:{label:"Low quality",variant:"muted"},c=(null==(r=e.sourceMeta)?void 0:r.refreshedAt)?new Date(e.sourceMeta.refreshedAt).toLocaleDateString():null;return(0,s.jsxs)("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"block rounded-xl border border-border/70 bg-muted/20 p-3 transition-colors hover:bg-muted/35",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-foreground",children:e.title}),(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[(0,s.jsx)(i.Ex,{variant:"muted",children:e.type}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)(n.A,{className:"h-3.5 w-3.5"}),function(e){if(!e)return"Duration pending";let r=Math.floor(e/60);return"".concat(r,":").concat((e%60).toString().padStart(2,"0"))}(e.durationSeconds)]}),(null==(t=e.sourceMeta)?void 0:t.channel)?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)(l.A,{className:"h-3.5 w-3.5"}),e.sourceMeta.channel]}):null,(0,s.jsxs)(i.Ex,{variant:o.variant,className:"gap-1",children:[(0,s.jsx)(d.A,{className:"h-3 w-3"}),o.label]}),c?(0,s.jsxs)("span",{children:["Refreshed ",c]}):null]})]},e.id)})}):(0,s.jsx)(i.pp,{title:"Resources pending",description:"Resources are still being curated for this lesson."})})]})}},6445:(e,r,t)=>{t.d(r,{cn:()=>n});var s=t(2821),a=t(5889);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},6948:(e,r,t)=>{t.d(r,{BT:()=>i,Wu:()=>c,ZB:()=>o,Zp:()=>l,aR:()=>d});var s=t(5155),a=t(2115),n=t(6445);let l=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("rounded-2xl border border-border/70 bg-card text-card-foreground shadow-sm",t),...a})});l.displayName="Card";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("p-5 pb-0",t),...a})});d.displayName="CardHeader";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("h3",{ref:r,className:(0,n.cn)("text-base font-semibold tracking-tight",t),...a})});o.displayName="CardTitle";let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})});i.displayName="CardDescription";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("p-5",t),...a})});c.displayName="CardContent",a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center gap-2 p-5 pt-0",t),...a})}).displayName="CardFooter"},7091:(e,r,t)=>{t.r(r),t.d(r,{RefreshResourcesButton:()=>u});var s=t(5155),a=t(2115),n=t(9559),l=t(1362),d=t(6132),o=t(3998),i=t(9893);async function c(e){return(0,i.n)("/api/lessons/".concat(e,"/resources"),{method:"POST",headers:{"Content-Type":"application/json"}})}function u(e){let{lessonId:r,onRefresh:t}=e,[i,u]=(0,a.useState)(!1),[m,x]=(0,a.useState)("idle"),[p,b]=(0,a.useState)(""),f=async()=>{u(!0),x("idle"),b("");try{let e=await c(r);x("success"),b("Updated ".concat(e.resources.length," resource(s)")),t(e.resources)}catch(e){x("error"),b(e instanceof Error?e.message:"Failed to refresh resources")}finally{u(!1),setTimeout(()=>{x("idle"),b("")},4500)}};return(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)(o.$,{onClick:f,disabled:i,variant:"secondary",size:"sm",children:[(0,s.jsx)(n.A,{className:"mr-1.5 h-3.5 w-3.5 ".concat(i?"animate-spin":"")}),i?"Refreshing...":"Refresh resources"]}),"success"===m?(0,s.jsxs)("span",{className:"flex items-center gap-1 text-xs text-emerald-700",role:"status",children:[(0,s.jsx)(l.A,{className:"h-3.5 w-3.5"}),p]}):null,"error"===m?(0,s.jsxs)("span",{className:"flex items-center gap-1 text-xs text-red-700",role:"status",children:[(0,s.jsx)(d.A,{className:"h-3.5 w-3.5"}),p]}):null]})}},7539:(e,r,t)=>{t.r(r),t.d(r,{ActivityDrawer:()=>g});var s=t(5155),a=t(2115),n=t(9559),l=t(5229),d=t(4033),o=t(7937),i=t(3998),c=t(6948),u=t(1647),m=t(6445),x=t(9893);async function p(e){let r=new URLSearchParams;return(null==e?void 0:e.userId)&&r.set("userId",e.userId),(null==e?void 0:e.programId)&&r.set("programId",e.programId),(null==e?void 0:e.lessonId)&&r.set("lessonId",e.lessonId),(null==e?void 0:e.status)&&r.set("status",e.status),(null==e?void 0:e.type)&&r.set("type",e.type),(null==e?void 0:e.limit)!==void 0&&r.set("limit",String(e.limit)),(null==e?void 0:e.offset)!==void 0&&r.set("offset",String(e.offset)),(0,x.n)("/api/jobs?".concat(r.toString()))}async function b(e){return(0,x.n)("/api/jobs/".concat(e))}function f(e){let r=new Date(e),t=new Date().getTime()-r.getTime(),s=Math.floor(t/6e4),a=Math.floor(t/36e5),n=Math.floor(t/864e5);return s<1?"Just now":s<60?"".concat(s,"m ago"):a<24?"".concat(a,"h ago"):"".concat(n,"d ago")}function h(e){switch(e.toUpperCase()){case"COMPLETED":case"DONE":return"success";case"RUNNING":case"IN_PROGRESS":return"warn";case"FAILED":case"ERROR":return"danger";default:return"muted"}}function g(e){let{open:r,onOpenChange:t,title:x="Background activity",programId:g,lessonId:j}=e,[v,y]=(0,a.useState)([]),[N,w]=(0,a.useState)({}),[k,R]=(0,a.useState)(!1),[A,C]=(0,a.useState)(null),[S,E]=(0,a.useState)(null),T=(0,a.useRef)(null),_=(0,a.useRef)(null),L=(0,a.useCallback)(async()=>{R(!0),C(null);try{let e=await p({limit:12,programId:g,lessonId:j});y(e.jobs)}catch(e){C(e instanceof Error?e.message:"Failed to fetch jobs")}finally{R(!1)}},[j,g]),I=(0,a.useCallback)(async e=>{try{let r=await b(e);w(t=>({...t,[e]:r.events||[]}))}catch(e){}},[]);(0,a.useEffect)(()=>{r&&L()},[L,r]),(0,a.useEffect)(()=>{S&&(N[S]||I(S))},[N,S,I]),(0,a.useEffect)(()=>{var e;if(!r)return;let s=e=>{"Escape"===e.key&&t(!1)},a=e=>{if("Tab"!==e.key||!T.current)return;let r=T.current.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])');if(0===r.length)return;let t=r[0],s=r[r.length-1],a=document.activeElement;e.shiftKey?a!==t&&T.current.contains(a)||(e.preventDefault(),s.focus()):a===s&&(e.preventDefault(),t.focus())};return window.addEventListener("keydown",s),window.addEventListener("keydown",a),null==(e=_.current)||e.focus(),()=>{window.removeEventListener("keydown",s),window.removeEventListener("keydown",a)}},[t,r]);let P=(0,a.useMemo)(()=>S&&N[S]||[],[N,S]);return r?(0,s.jsxs)("div",{className:"fixed inset-0 z-50","aria-live":"polite",children:[(0,s.jsx)("button",{"aria-label":"Close activity drawer",className:"absolute inset-0 bg-foreground/20 backdrop-blur-[1px]",onClick:()=>t(!1)}),(0,s.jsxs)("aside",{ref:T,role:"dialog","aria-modal":"true","aria-label":x,className:"absolute right-0 top-0 h-full w-full max-w-lg border-l border-border bg-background p-4 shadow-2xl overflow-y-auto",children:[(0,s.jsxs)("div",{className:"mb-4 flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-display text-xl font-semibold text-foreground",children:x}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:v.length>0?"".concat(v.length," recent jobs"):"No recent activity"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.$,{variant:"ghost",size:"icon",onClick:()=>void L(),disabled:k,"aria-label":"Refresh jobs",children:(0,s.jsx)(n.A,{className:(0,m.cn)("h-4 w-4",k&&"animate-spin")})}),(0,s.jsx)(i.$,{ref:_,variant:"ghost",size:"icon",onClick:()=>t(!1),"aria-label":"Close drawer",children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})]})]}),A?(0,s.jsx)("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:A}):null,k?(0,s.jsx)("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:(0,s.jsx)(n.A,{className:"h-5 w-5 animate-spin"})}):0===v.length?(0,s.jsx)("div",{className:"rounded-xl border border-dashed border-border p-6 text-center text-sm text-muted-foreground",children:"No recent activity to display."}):(0,s.jsx)("div",{className:"space-y-2",children:v.map(e=>{var r,t;let a=S===e.id,n="program_build"===e.type&&"number"==typeof e.totalLessons&&e.totalLessons>0?Math.round((e.completedLessons||0)/e.totalLessons*100):null;return(0,s.jsxs)("div",{children:[(0,s.jsx)(c.Zp,{className:(0,m.cn)("cursor-pointer rounded-2xl transition-colors",a&&"border-primary/40 bg-primary/5"),onClick:()=>E(a?null:e.id),children:(0,s.jsxs)(c.Wu,{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex min-w-0 items-start gap-2",children:[a?(0,s.jsx)(d.A,{className:"mt-0.5 h-4 w-4 text-muted-foreground"}):(0,s.jsx)(o.A,{className:"mt-0.5 h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-foreground",children:"program_build"===(t=e.type)?"Program Build":"lesson_resource_refresh"===t?"Resource Refresh":t.replaceAll("_"," ")}),(0,s.jsx)("p",{className:"truncate text-xs text-muted-foreground",children:(null==(r=e.program)?void 0:r.topic)||"Background task"}),e.currentPhase?(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Phase: ",e.currentPhase]}):null,e.error?(0,s.jsx)("p",{className:"mt-1 text-xs text-red-700",children:e.error}):null]})]}),(0,s.jsxs)("div",{className:"shrink-0 text-right",children:[(0,s.jsx)(u.E,{variant:h(e.status),children:e.status}),(0,s.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:f(e.createdAt)})]})]}),null!==n?(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-center justify-between text-[11px] text-muted-foreground",children:[(0,s.jsxs)("span",{children:[e.completedLessons||0,"/",e.totalLessons," lessons"]}),(0,s.jsxs)("span",{children:[n,"%"]})]}),(0,s.jsx)("div",{className:"h-1.5 rounded-full bg-muted",children:(0,s.jsx)("div",{className:"h-full rounded-full bg-primary",style:{width:"".concat(n,"%")}})})]}):null]})}),a?(0,s.jsx)("div",{className:"ml-5 mt-1 rounded-xl border border-border/70 bg-muted/30 p-2",children:0===P.length?(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Loading events..."}):(0,s.jsx)("div",{className:"space-y-1.5",children:P.slice(0,20).map(e=>(0,s.jsxs)("div",{className:"rounded-lg border border-border/60 bg-background p-2 text-xs",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("p",{className:"font-semibold text-foreground",children:e.step}),(0,s.jsx)(u.E,{variant:h(e.status),className:"text-[10px]",children:e.status})]}),e.message?(0,s.jsx)("p",{className:"mt-0.5 text-muted-foreground",children:e.message}):null,(0,s.jsx)("p",{className:"mt-0.5 text-[10px] text-muted-foreground/80",children:f(e.createdAt)})]},e.id))})}):null]},e.id)})})]})]}):null}},7777:(e,r,t)=>{t.r(r),t.d(r,{StatusStrip:()=>p});var s=t(5155),a=t(1362),n=t(5299),l=t(5740),d=t(6168),o=t(6132),i=t(906),c=t(3998),u=t(1647),m=t(6445);let x={ready:{label:"Ready",detail:"Everything needed for this view is available.",icon:(0,s.jsx)(a.A,{className:"h-4 w-4"}),badgeVariant:"success"},running:{label:"Background Running",detail:"Agents are actively generating and syncing artifacts.",icon:(0,s.jsx)(n.A,{className:"h-4 w-4 animate-spin"}),badgeVariant:"warn"},"partial-ready":{label:"Partial Ready",detail:"Some sections are available while generation continues.",icon:(0,s.jsx)(l.A,{className:"h-4 w-4"}),badgeVariant:"info"},"needs-input":{label:"Needs Input",detail:"Complete the next action to continue progress.",icon:(0,s.jsx)(d.A,{className:"h-4 w-4"}),badgeVariant:"muted"},error:{label:"Attention Needed",detail:"A blocking issue was detected. Review the activity log.",icon:(0,s.jsx)(o.A,{className:"h-4 w-4"}),badgeVariant:"danger"}};function p(e){let{status:r,onViewActivity:t,label:a,className:n}=e,l=x[r];return(0,s.jsxs)("div",{className:(0,m.cn)("flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-border/80 bg-card px-4 py-3",n),children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)(u.E,{variant:l.badgeVariant,className:"gap-1.5",children:[l.icon,a||l.label]}),(0,s.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:l.detail})]}),t?(0,s.jsxs)(c.$,{variant:"ghost",size:"sm",onClick:t,children:[(0,s.jsx)(i.A,{className:"mr-1.5 h-4 w-4"}),"Activity"]}):null]})}},9893:(e,r,t)=>{t.d(r,{n:()=>s});async function s(e,r){let t=await fetch(e,r),s=await t.json();if(!t.ok)throw Error(s.error||"Request failed");return s}}}]);